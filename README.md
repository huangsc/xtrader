# 🚀 智能加密货币交易机器人 V1.0

> **专业级量化交易系统，集成动量与波段策略，提供企业级风险控制和系统监控**

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://python.org)
[![Binance](https://img.shields.io/badge/Exchange-Binance-yellow.svg)](https://binance.com)
[![License](https://img.shields.io/badge/License-MIT-green.svg)](LICENSE)

## 📋 项目简介

这是一个功能完整的加密货币自动交易机器人，基于技术分析指标实现智能交易决策。系统采用模块化设计，具备完善的风险管理、实时监控和灾难恢复功能，适合个人投资者和专业交易团队使用。

### 🎯 核心特性

- **🧠 智能策略**: 动量突破 + 波段回调双策略融合
- **⚡ 实时交易**: 毫秒级价格监控和订单执行  
- **🛡️ 风险控制**: 多层次风险管理和资金保护
- **📊 市场分析**: ADX趋势识别和布林带状态检测
- **🔄 自动优化**: 基于历史表现动态调整参数
- **💾 灾难恢复**: 系统状态自动保存和崩溃恢复
- **📱 实时通知**: Telegram消息推送和日志记录
- **⚙️ 配置驱动**: 无需修改代码即可调整所有参数

## 🏗️ 系统架构

```
交易机器人系统
├── 数据层
│   ├── 实时价格获取 (三重容错)
│   ├── K线数据处理
│   └── 技术指标计算
├── 策略层  
│   ├── 动量突破策略
│   ├── 波段回调策略
│   └── 市场状态检测
├── 执行层
│   ├── 订单管理系统
│   ├── 风险控制引擎
│   └── 仓位管理器
├── 监控层
│   ├── 系统资源监控
│   ├── 交易性能分析
│   └── 异常告警系统
└── 配置层
    ├── 参数配置管理
    ├── 策略参数优化
    └── 系统状态恢复
```

## 🚀 核心功能详解

### 1. 📊 智能交易策略

#### 动量突破策略 (MOMENTUM)
- **触发条件**: RSI > 60 且价格突破布林带上轨
- **适用场景**: 强势上涨趋势的延续
- **止损策略**: ATR的1.8倍
- **止盈策略**: ATR的3.5倍

#### 波段回调策略 (SWING)  
- **触发条件**: RSI < 40 且价格触及布林带下轨
- **适用场景**: 超跌反弹和趋势回调
- **止损策略**: ATR的1.3倍
- **止盈策略**: ATR的2.5倍

#### 市场状态识别
- **TRENDING**: ADX > 25，强趋势市场
- **RANGING**: ADX < 20，横盘震荡市场
- **OVERSOLD**: RSI < 30，超卖状态
- **OVERBOUGHT**: RSI > 70，超买状态

### 2. 🛡️ 多层风险控制

#### 仓位管理
- **固定风险模式**: 每笔交易风险固定为账户资金的2.25%
- **动态调整**: 基于近期20笔交易表现自动优化风险参数
- **最大持仓**: 单币种持仓不超过预设上限

#### 资金保护
- **资金下限**: 账户余额低于$800自动停止交易
- **盈利保护**: 账户余额超过$1300启动保守模式
- **每日限制**: 单日亏损超过6%停止当日交易
- **最大回撤**: 从高点回撤超过12%暂停交易

#### 交易限制
- **滑点控制**: 超过0.5%滑点自动取消订单
- **频次限制**: 每日最多4笔交易，防止过度交易
- **波动过滤**: ATR超过均值1.5倍时跳过交易

### 3. ⚡ 高可靠性执行

#### 价格获取容错
- **三重重试**: API调用失败自动重试3次
- **备用数据源**: 主要价格源失败时使用K线数据
- **网络恢复**: 自动检测并恢复网络连接

#### 订单生命周期管理
- **实时监控**: 每个订单都有独立的监控线程
- **超时处理**: 2分钟未成交自动取消订单
- **状态同步**: 实时更新订单状态和账户余额

#### 系统监控
- **资源监控**: 实时监控内存、CPU使用率
- **性能告警**: 系统资源超限时发送告警
- **日志轮转**: 自动管理日志文件大小和数量

### 4. 🔄 智能参数优化

#### 自适应风险调整
- **胜率分析**: 基于近期交易胜率调整风险参数
- **盈亏比优化**: 根据平均盈亏比调整仓位大小
- **市场适应**: 不同市场状态使用不同参数组合

#### 动态参数范围
- **保守模式**: 风险参数1.5%-2.0%
- **平衡模式**: 风险参数2.0%-2.5%  
- **激进模式**: 风险参数2.5%-3.5%

### 5. 💾 灾难恢复机制

#### 状态保存
- **定时保存**: 每30分钟自动保存系统状态
- **关键时刻**: 重要操作前自动保存状态
- **数据完整性**: 保存交易历史、订单状态、账户信息

#### 崩溃恢复
- **自动检测**: 启动时检测是否存在未完成的订单
- **状态恢复**: 从保存的状态文件恢复系统状态
- **数据一致性**: 确保恢复后数据的完整性和一致性

## 🛠️ 快速开始

### 方式一：自动安装（推荐）
```bash
# 克隆项目
git clone https://github.com/your-repo/crypto-trading-bot.git
cd crypto-trading-bot

# 运行自动设置脚本
chmod +x setup.sh
./setup.sh
```

### 方式二：手动安装
```bash
# 1. 安装Python依赖
pip install -r requirements.txt

# 2. 复制配置文件
cp config.json.example config.json

# 3. 编辑配置文件
nano config.json

# 4. 运行机器人
python trading.py
```

### 🔧 配置要求

#### 必需配置
- **Binance API**: 需要有效的API密钥对
- **Telegram Bot**: 用于接收交易通知（可选）
- **初始资金**: 建议不少于$1000用于测试

#### 推荐配置
```json
{
  "api": {
    "testnet": true,                     // 首次使用务必开启测试模式
    "api_key": "YOUR_API_KEY",
    "api_secret": "YOUR_API_SECRET"
  },
  "trading": {
    "leverage": 2,                       // 新手建议使用1-2倍杠杆
    "risk_percent": 0.0225,              // 保守的风险比例
    "max_daily_trades": 4                // 适中的交易频次
  }
}
```

## 📁 项目结构

```
crypto-trading-bot/
├── trading.py              # 🎯 主程序文件 - 核心交易逻辑
├── config.json             # ⚙️ 配置文件 - 所有参数设置
├── config.json.example     # 📋 配置模板 - 带详细注释说明  
├── CONFIG_GUIDE.md         # 📖 配置指南 - 详细使用说明
├── requirements.txt        # 📦 依赖清单 - Python包依赖
├── setup.sh               # 🚀 安装脚本 - 一键环境配置
├── README.md              # 📚 项目文档 - 完整使用说明
├── trading.log            # 📝 日志文件 - 运行日志（自动生成）
└── recovery.json          # 💾 恢复文件 - 系统状态备份（自动生成）
```

### 📋 文件说明

| 文件 | 描述 | 重要性 |
|------|------|--------|
| `trading.py` | 主程序，包含所有交易逻辑和系统功能 | ⭐⭐⭐⭐⭐ |
| `config.json` | 配置文件，控制所有交易参数和系统设置 | ⭐⭐⭐⭐⭐ |
| `config.json.example` | 配置模板，新用户复制此文件开始配置 | ⭐⭐⭐⭐ |
| `CONFIG_GUIDE.md` | 详细配置指南，包含最佳实践建议 | ⭐⭐⭐⭐ |
| `requirements.txt` | Python依赖包列表，用于环境配置 | ⭐⭐⭐ |
| `setup.sh` | 自动安装脚本，简化环境配置过程 | ⭐⭐⭐ |

## 📋 配置文件详解

### 🔧 配置文件特性
- **支持注释**: 配置文件支持 `//` 行尾注释，方便理解每个参数的作用
- **详细说明**: 每个配置项都有详细的中文注释说明
- **参数验证**: 启动时自动验证配置参数的合法性
- **模块化配置**: 配置按功能分组，便于管理

### 📁 配置文件结构

#### 🔗 API配置 (`api`)
```json
"api": {
  "api_key": "YOUR_API_KEY",           // Binance API密钥 - 在币安官网申请
  "api_secret": "YOUR_API_SECRET",     // Binance API秘钥 - 配合密钥使用
  "testnet": true                      // 测试模式 - true为测试环境，false为实盘环境
}
```

#### 📱 Telegram通知 (`telegram`)
```json
"telegram": {
  "token": "YOUR_TELEGRAM_TOKEN",      // Telegram机器人Token - 从@BotFather获取
  "chat_id": "YOUR_CHAT_ID"           // Telegram聊天ID - 接收通知的群组或个人ID
}
```

#### 💰 核心交易参数 (`trading`)
```json
"trading": {
  "initial_balance": 1000.0,           // 初始资金 - 用于计算仓位大小的基准金额
  "leverage": 2,                       // 杠杆倍数 - 建议1-3倍，过高风险极大
  "risk_percent": 0.0225,              // 单笔风险比例 - 每笔交易风险占总资金的百分比(2.25%)
  "max_daily_trades": 4,               // 每日最大交易次数 - 防止过度交易
  "trade_interval": "15m"              // 交易时间框架 - 支持1m,3m,5m,15m,30m,1h,4h,1d
}
```

#### 🛡️ 安全保护参数 (`safety`)
```json
"safety": {
  "max_slippage": 0.005,               // 最大滑点容忍度 - 0.5%，超过此值取消交易
  "api_retries": 3,                    // API调用重试次数 - 网络异常时自动重试
  "api_timeout": 10,                   // API超时时间(秒) - 请求超时限制
  "max_open_orders": 5,                // 最大挂单数量 - 防止订单过多系统过载
  "memory_limit": 70,                  // 内存使用限制(%) - 超过此值暂停交易
  "volatility_factor": 1.5             // 波动率过滤因子 - ATR超过均值1.5倍时跳过交易
}
```

#### ⚠️ 风险控制参数 (`risk_control`)
```json
"risk_control": {
  "risk_floor": 800,                   // 资金保护下限($) - 账户低于此值停止所有交易
  "profit_ceiling": 1300,              // 盈利保护上限($) - 账户超过此值降低风险参数
  "daily_loss_limit": 0.06,            // 每日亏损限制(6%) - 单日亏损超过此比例停止当日交易
  "max_drawdown": 0.12                 // 最大回撤限制(12%) - 从高点回撤超过此值暂停交易
}
```

#### 🪙 交易品种配置 (`symbols`)
```json
"symbols": {
  "BTCUSDT": {
    "risk_weight": 0.6,                // 风险权重 - 该币种占总风险预算的比例(60%)
    "min_qty": 0.001,                  // 最小交易数量 - 交易所限制的最小下单量
    "max_position_usd": 300,            // 单币种最大持仓($) - 防止单一品种风险过度集中
    "stop_multiplier": {                // 止损倍数 - 基于ATR计算止损距离
      "MOMENTUM": 1.8,                  // 动量策略止损倍数 - ATR的1.8倍
      "SWING": 1.3                      // 波段策略止损倍数 - ATR的1.3倍
    },
    "profit_multiplier": {              // 止盈倍数 - 基于ATR计算止盈距离
      "MOMENTUM": 3.5,                  // 动量策略止盈倍数 - ATR的3.5倍
      "SWING": 2.5                      // 波段策略止盈倍数 - ATR的2.5倍
    }
  }
}
```

#### ⚙️ 系统运行参数 (`system`)
```json
"system": {
  "log_level": "INFO",                 // 日志级别 - DEBUG/INFO/WARNING/ERROR
  "log_max_size": 5242880,             // 单个日志文件最大大小(字节) - 5MB
  "log_backup_count": 3,               // 日志文件备份数量 - 保留3个历史日志文件
  "recovery_save_interval": 1800,      // 状态保存间隔(秒) - 每30分钟保存一次系统状态
  "system_monitor_interval": 300,      // 系统监控检查间隔(秒) - 每5分钟检查系统资源
  "performance_window": 20             // 性能评估窗口 - 基于最近20笔交易优化参数
}
```

### 🔍 配置说明

#### 重要参数说明
- **杠杆倍数**: 建议1-3倍，新手建议使用1倍
- **风险比例**: 每笔交易风险占总资金的百分比，建议2-3%
- **滑点容忍度**: 市场波动大时可适当调高至1%
- **风险权重**: 多币种时的风险分配，总和应该为1.0

#### 安全建议
- 测试环境充分验证后再使用实盘
- 实盘初始资金建议不超过总资金的10%
- 定期检查参数的有效性
- 关注市场极端情况下的表现

## 📊 系统监控

### 🔔 Telegram通知类型
- 🚀 **系统启动** - 机器人启动成功通知
- ✅ **订单成交** - 买入/卖出订单执行成功
- ❌ **订单失败** - 订单执行失败原因
- ⚠️ **系统警告** - 资源使用、网络异常等警告
- 🔴 **风险告警** - 触发风险控制机制
- 🛑 **系统停止** - 机器人停止运行通知
- 📈 **交易报告** - 定期交易统计报告

### 📝 日志系统
- **INFO**: 正常交易操作、系统状态更新
- **WARNING**: 网络延迟、轻微异常情况
- **ERROR**: API错误、订单失败、系统异常
- **DEBUG**: 详细的调试信息（可配置）

### 📈 性能指标
- **交易胜率**: 基于近期交易统计
- **平均盈亏比**: 盈利交易与亏损交易比例
- **最大回撤**: 从高点到低点的最大跌幅
- **夏普比率**: 风险调整后的收益率
- **系统资源**: CPU、内存使用率监控

## ⚠️ 风险提示与免责声明

### 🚨 重要风险提示

1. **市场风险**
   - 加密货币市场波动极大，可能面临重大损失
   - 杠杆交易会放大盈利和亏损
   - 市场流动性不足可能导致无法及时平仓

2. **技术风险**
   - 网络中断可能导致无法及时执行交易
   - API限制或交易所故障可能影响交易执行
   - 软件bug或配置错误可能导致意外损失

3. **操作风险**
   - 错误的参数配置可能导致过度交易
   - API密钥泄露可能导致资金损失
   - 缺乏监控可能错过重要的市场变化

### 💡 安全建议

1. **资金管理**
   - 🔸 **测试优先**: 在测试环境充分验证策略有效性
   - 🔸 **小额开始**: 实盘初始资金建议不超过总资金的5-10%
   - 🔸 **分散投资**: 不要将所有资金投入单一策略
   - 🔸 **定期评估**: 每周评估策略表现并调整参数

2. **技术安全**
   - 🔸 **API安全**: 使用只读权限或限制提现的API密钥
   - 🔸 **网络稳定**: 确保服务器网络连接稳定
   - 🔸 **备份重要**: 定期备份配置文件和交易数据
   - 🔸 **监控告警**: 设置Telegram通知及时了解系统状态

3. **策略优化**
   - 🔸 **参数调优**: 根据市场变化适时调整策略参数
   - 🔸 **止损严格**: 严格执行止损策略，控制单笔损失
   - 🔸 **情绪控制**: 避免因短期亏损而频繁修改策略
   - 🔸 **持续学习**: 不断学习市场知识和技术分析方法

### 📞 技术支持

#### 问题排查步骤
1. **查看日志**: 检查 `trading.log` 文件中的错误信息
2. **检查配置**: 验证 `config.json` 配置参数是否正确
3. **网络测试**: 确认网络连接和API访问正常
4. **资源监控**: 检查系统CPU、内存使用情况
5. **状态恢复**: 如有必要，删除 `recovery.json` 重新开始

#### 常见问题解决
- **API错误**: 检查API密钥权限和网络连接
- **内存不足**: 调整系统监控参数或升级服务器配置
- **订单失败**: 检查账户余额和交易权限设置
- **策略无信号**: 调整技术指标参数或市场选择

## 📄 免责声明

本交易机器人仅供学习和研究使用。使用本软件进行实际交易的所有风险由用户自行承担。开发者不对因使用本软件而导致的任何直接或间接损失承担责任。

**请在充分理解风险的前提下谨慎使用，投资有风险，入市需谨慎！**

## 📜 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件

---

## 🎯 版本信息

**当前版本**: V1.0  
**发布日期**: 2024年  
**兼容性**: Python 3.8+  
**支持交易所**: Binance (现货/合约)

### 🔄 后续规划
- [ ] 支持更多交易所 (OKX, Bybit)
- [ ] 增加更多技术指标策略
- [ ] Web界面监控面板
- [ ] 移动端App通知
- [ ] 策略回测功能
- [ ] 社区策略分享

---

**⭐ 如果这个项目对您有帮助，请给个Star支持！** 